Ext.namespace("Ext.om");Ext.om.DatetimePicker=function(a){Ext.om.DatetimePicker.superclass.constructor.call(this,a);this.hour_step=(a&&a.hourStep)?a.hourStep:1;this.minute_step=(a&&a.minuteStep)?a.minuteStep:5;this.hr_up_label=this.hr_up.replace("{0}",this.hour_step);this.hr_down_label=this.hr_down.replace("{0}",this.hour_step);this.min_up_label=this.min_up.replace("{0}",this.minute_step);this.min_down_label=this.min_down.replace("{0}",this.minute_step);this.limitedAlign=(a&&a.limitedAlign)?a.limitedAlign:false;if(a&&a.hourFilter){this.hourFilter=a.hourFilter}if(a&&a.minuteFilter){this.minuteFilter=a.minuteFilter}};Ext.extend(Ext.om.DatetimePicker,Ext.DatePicker,{hour_label:"时：",min_label:"分：",hr_up:"加{0}小时",hr_down:"减{0}小时",min_up:"加{0}分钟",min_down:"减{0}分钟",_adjust:function(e,d,c){var b=e%d,a=e-b+((!this.limitedAlign&&b>d/2)?d:0);if(a>c){a=c-c%d}return a},selectToday:function(){this.setValue(new Date().clearTime());var a=this.value;a.setHours(this.theHours);a.setMinutes(this.theMinutes);this.fireEvent("select",this,a)},handleDateClick:function(c,a){c.stopEvent();if(a.dateValue&&!Ext.fly(a.parentNode).hasClass("x-date-disabled")){this.setValue(new Date(a.dateValue));var b=this.value;b.setHours(this.theHours);b.setMinutes(this.theMinutes);this.fireEvent("select",this,b)}},_incHour:function(){var a=this.theHours,b=false,c=false;do{a+=this.hour_step;if(a>23){a=0;b=true}c=!this.hourFilter||this.hourFilter(a,this.theMinutes)}while(!c&&(!b||a<this.theHours));if(c){this.theHours=a}},_decHour:function(){var a=this.theHours,b=false,c=false;do{a-=this.hour_step;if(a<0){a=this._adjust(23,this.hour_step,23);b=true}c=!this.hourFilter||this.hourFilter(a,this.theMinutes)}while(!c&&(!b||a>this.theHours));if(c){this.theHours=a}},_incMin:function(){var a=this.theMinutes,b=false,c=false;do{a+=this.minute_step;if(a>59){a=0;b=true}c=!this.minuteFilter||this.minuteFilter(a,this.theHours)}while(!c&&(!b||a<this.theMinutes));if(c){this.theMinutes=a}},_decMin:function(){var a=this.theMinutes,b=false,c=false;do{a-=this.minute_step;if(a<0){a=this._adjust(59,this.minute_step,59);b=true}c=!this.minuteFilter||this.minuteFilter(a,this.theHours)}while(!c&&(!b||a>this.theMinutes));if(c){this.theMinutes=a}},onRender:function(a,j){var e=['<table cellspacing="0">','<tr><td colspan="3"><table cellspacing="0" width="100%"><tr><td class="x-date-left"><a href="#" title="',this.prevText,'">*</a></td><td class="x-date-middle" align="center"></td><td class="x-date-right"><a href="#" title="',this.nextText,'">*</a></td></tr></table></td></tr>','<tr><td colspan="3"><table class="x-date-inner" cellspacing="0"><thead><tr>'],h=this.dayNames;for(var g=0;g<7;g++){var k=this.startDay+g;if(k>6){k=k-7}e.push("<th><span>",h[k].substr(0,1),"</span></th>")}e[e.length]="</tr></thead><tbody><tr>";for(g=0;g<42;g++){if(g%7===0&&g!==0){e[e.length]="</tr><tr>"}e[e.length]='<td><a href="#" hidefocus="on" class="x-date-date" tabIndex="1"><em><span></span></em></a></td>'}e[e.length]='</tr></tbody></table></td></tr><tr><td class="minutecss"><table cellspacing="0" ><tr>';e.push('<td class="y-hour-label">',this.hour_label,'</td><td class="y-hour-left"><a href="#" title="',this.hr_down_label,'"> </a></td><td class="y-hour-middle" align="center"></td><td class="y-hour-right"><a href="#" title="',this.hr_up_label,'"> </a></td>');e.push('<td class="y-minute-label">',this.min_label,'<td class="y-minute-left"><a href="#" title="',this.min_down_label,'"> </a></td><td class="y-minute-middle" align="center"></td><td class="y-minute-right"><a href="#" title="',this.min_up_label,'"> </a></td>');e[e.length]='</tr></table></td><td  colspan="2" class="x-date-bottom" align="center"></td></tr></table><div class="x-date-mp"></div>';var b=document.createElement("div");b.className="x-date-picker";b.innerHTML=e.join("");a.dom.insertBefore(b,j);this.el=Ext.get(b);this.eventEl=Ext.get(b.firstChild);new Ext.util.ClickRepeater(this.el.child("td.x-date-left a"),{handler:this.showPrevMonth,scope:this,preventDefault:true,stopDefault:true});new Ext.util.ClickRepeater(this.el.child("td.x-date-right a"),{handler:this.showNextMonth,scope:this,preventDefault:true,stopDefault:true});new Ext.util.ClickRepeater(this.el.child("td.y-hour-left a"),{handler:function(){this._decHour();var d="";if(this.theHours<10){d="0"+this.theHours}else{d=this.theHours}this.hourLabel.update(d)}.createDelegate(this),scope:this});new Ext.util.ClickRepeater(this.el.child("td.y-hour-right a"),{handler:function(){this._incHour();var d="";if(this.theHours<10){d="0"+this.theHours}else{d=this.theHours}this.hourLabel.update(d)}.createDelegate(this),scope:this});new Ext.util.ClickRepeater(this.el.child("td.y-minute-left a"),{handler:function(){this._decMin();var d="";if(this.theMinutes<10){d="0"+this.theMinutes}else{d=this.theMinutes}this.minuteLabel.update(d)}.createDelegate(this),scope:this});new Ext.util.ClickRepeater(this.el.child("td.y-minute-right a"),{handler:function(){this._incMin();var d="";if(this.theMinutes<10){d="0"+this.theMinutes}else{d=this.theMinutes}this.minuteLabel.update(d)}.createDelegate(this),scope:this});this.eventEl.on("mousewheel",this.handleMouseWheel,this);this.monthPicker=this.el.down("div.x-date-mp");this.monthPicker.enableDisplayMode("block");new Ext.KeyNav(this.eventEl,{left:function(d){d.ctrlKey?this.showPrevMonth():this.update(this.activeDate.add("d",-1))},right:function(d){d.ctrlKey?this.showNextMonth():this.update(this.activeDate.add("d",1))},up:function(d){d.ctrlKey?this.showNextYear():this.update(this.activeDate.add("d",-7))},down:function(d){d.ctrlKey?this.showPrevYear():this.update(this.activeDate.add("d",7))},pageUp:function(d){this.showNextMonth()},pageDown:function(d){this.showPrevMonth()},enter:function(d){d.stopPropagation();return true},scope:this});this.eventEl.on("click",this.handleDateClick,this,{delegate:"a.x-date-date"});this.eventEl.addKeyListener(Ext.EventObject.SPACE,this.selectToday,this);this.el.unselectable();this.cells=this.el.select("table.x-date-inner tbody td");this.textNodes=this.el.query("table.x-date-inner tbody span");this.mbtn=new Ext.Button({text:"*",tooltip:this.monthYearText,renderTo:this.el.child("td.x-date-middle",true)});this.mbtn.on("click",this.showMonthPicker,this);this.mbtn.el.child(this.mbtn.menuClassTarget).addClass("x-btn-with-menu");var c=new Date(),f="";this.hourLabel=this.el.child("td.y-hour-middle");this.theHours=this._adjust(c.getHours(),this.hour_step,23);if(this.theHours<10){f="0"+this.theHours}else{f=this.theHours}this.hourLabel.update(f);this.minuteLabel=this.el.child("td.y-minute-middle");this.theMinutes=this._adjust(c.getMinutes(),this.minute_step,59);if(this.theMinutes<10){f="0"+this.theMinutes}else{f=this.theMinutes}this.minuteLabel.update(f);var l=(new Date()).dateFormat(this.format);new Ext.Button({renderTo:this.el.child("td.x-date-bottom",true),text:String.format(this.todayText,l),tooltip:String.format(this.todayTip,l),handler:this.selectToday,scope:this});if(Ext.isIE){this.el.repaint()}this.update(this.value)},update:function(z){var a=this.activeDate;this.activeDate=z;if(a&&this.el){var k=z.getTime();if(a.getMonth()==z.getMonth()&&a.getFullYear()==z.getFullYear()){this.cells.removeClass("x-date-selected");this.cells.each(function(d){if(d.dom.firstChild.dateValue==k){d.addClass("x-date-selected");setTimeout(function(){try{d.dom.firstChild.focus()}catch(i){}},50);return false}});return}}var g=z.getDaysInMonth(),l=z.getFirstDateOfMonth(),c=l.getDay()-this.startDay;if(c<=this.startDay){c+=7}var u=z.add("mo",-1),e=u.getDaysInMonth()-c,b=this.cells.elements,m=this.textNodes;g+=c;var x=(new Date(u.getFullYear(),u.getMonth(),e)).clearTime(),v=new Date().clearTime().getTime(),p=z.clearTime().getTime(),o=this.minDate?this.minDate.clearTime():Number.NEGATIVE_INFINITY,r=this.maxDate?this.maxDate.clearTime():Number.POSITIVE_INFINITY,A=this.disabledDatesRE,n=this.disabledDatesText,C=this.disabledDays?this.disabledDays.join(""):false,y=this.disabledDaysText,s=this.format;var h=function(D,d){d.title="";var i=x.getTime();d.firstChild.dateValue=i;if(i==v){d.className+=" x-date-today";d.title=D.todayText}if(i==p){d.className+=" x-date-selected";setTimeout(function(){try{d.firstChild.focus()}catch(t){}},50)}if(i<o){d.className=" x-date-disabled";d.title=D.minText;return}if(i>r){d.className=" x-date-disabled";d.title=D.maxText;return}if(C){if(C.indexOf(x.getDay())!=-1){d.title=y;d.className=" x-date-disabled"}}if(A&&s){var w=x.dateFormat(s);if(A.test(w)){d.title=n.replace("%0",w);d.className=" x-date-disabled"}}};var q=0;for(;q<c;q++){m[q].innerHTML=(++e);x.setDate(x.getDate()+1);b[q].className="x-date-prevday";h(this,b[q])}for(;q<g;q++){intDay=q-c+1;m[q].innerHTML=(intDay);x.setDate(x.getDate()+1);b[q].className="x-date-active";h(this,b[q])}var B=0;for(;q<42;q++){m[q].innerHTML=(++B);x.setDate(x.getDate()+1);b[q].className="x-date-nextday";h(this,b[q])}this.mbtn.setText(this.monthNames[z.getMonth()]+" "+z.getFullYear());if(this.theHours<10){txt="0"+this.theHours}else{txt=this.theHours}this.hourLabel.update(txt);if(this.theMinutes<10){txt="0"+this.theMinutes}else{txt=this.theMinutes}this.minuteLabel.update(txt);if(!this.internalRender){var f=this.el.dom.firstChild,j=f.offsetWidth;this.el.setWidth(j+this.el.getBorderWidth("lr"));Ext.fly(f).setWidth(j);this.internalRender=true;if(Ext.isOpera&&!this.secondPass){f.rows[0].cells[1].style.width=(j-(f.rows[0].cells[0].offsetWidth+f.rows[0].cells[2].offsetWidth))+"px";this.secondPass=true;this.update.defer(10,this,[z])}}},nextYearText:"Next Year (Control+Up)",prevYearText:"Previous Year (Control+Down)"});Ext.om.DatetimeItem=function(a){Ext.om.DatetimeItem.superclass.constructor.call(this,new Ext.om.DatetimePicker(a),a);this.picker=this.component;this.addEvents({select:true});this.picker.on("render",function(b){b.getEl().swallowEvent("click");b.container.addClass("x-menu-date-item")});this.picker.on("select",this.onSelect,this)};Ext.extend(Ext.om.DatetimeItem,Ext.menu.Adapter,{onSelect:function(b,a){this.fireEvent("select",this,a,b);Ext.om.DatetimeItem.superclass.handleClick.call(this)}});Ext.om.DatetimeMenu=function(a){Ext.om.DatetimeMenu.superclass.constructor.call(this,a);this.plain=true;var b=new Ext.om.DatetimeItem(a);this.add(b);this.picker=b.picker;this.relayEvents(b,["select"])};Ext.extend(Ext.om.DatetimeMenu,Ext.menu.Menu,{render:function(){Ext.om.DatetimeMenu.superclass.render.call(this);if(Ext.isGecko){this.picker.el.dom.childNodes[0].style.width="200px";this.picker.el.dom.style.width="200px"}}});